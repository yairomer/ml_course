<!doctype html>
<html lang="en">
    <head>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
        <link href="https://fonts.googleapis.com/css?family=Special+Elite" rel="stylesheet">
    </head>
    <body>
        <div class="container">
            <div class="row" style = "font-family:Special Elite,serif;font-size:20px">
                Select rotation matrix to rotate the data.
            </div>
            <div class="row">
                <div class="col-9">
                    <div id="fig1" style="height: 600px;"></div>
                </div>
                <div class="col-3">
                    <div class="row">
                        Covariance matrix after rotation:
                    </div>
                    <div class="row">
                        <span id=covMatText></span>
                    </div>
                </div>
            <div class="row">
                <div class="col">
                    Select rotation matrix
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <button id="matrixAButton" class="btn btn-primary">$$A=\begin{bmatrix}-0.86 & 0.45 & -0.24 \\ -0.19 & -0.72 & -0.67 \\ -0.48 & -0.52 &  0.71  \\ \end{bmatrix}$$</button>
                </div>
                <div class="col-3">
                    <button id="matrixBButton" class="btn btn-primary">$$B=\begin{bmatrix}0.71  & 0.28 & -0.64 \\ -0.69  & 0.13 & -0.71 \\ -0.11  & 0.95  & 0.29  \\ \end{bmatrix}$$</button>
                </div>
                <div class="col-3">
                    <button id="matrixCButton" class="btn btn-primary">$$C=\begin{bmatrix}0.58  & -0.71  & -0.41  \\-0.58  & 0  & 0.82  \\0.58  & -0.71  & 0.41  \\\end{bmatrix}$$</button>
                </div>
                <div class="col-3">
                    <button id="matrixDButton" class="btn btn-primary">$$D=\begin{bmatrix}-0.087  & 0.68  & 0.72 \\ -0.88  & 0.29 & -0.37 \\ -0.46 & -0.68  & 0.57  \\ \end{bmatrix}$$</button>
                </div>
            </div>
        </div>
        <script>
            App = class {
                constructor() {
                    // ## Parameters

                    this.data = null;

                    // ### Rotation matrices
                    this.mat_a = [[-0.8577182409977431,0.45413046819962216,-0.24100816772991246],[-0.19456459875913087,-0.7206340034201331,-0.6654556709686752],[-0.475882376191256,-0.5238818101131811,0.706458642146234]];
                    this.mat_b = [[0.7126301429070299,0.2759452700875509,-0.6449903001880067],[-0.6928036116413455,0.13217376439068712,-0.7089099037984326],[-0.11036953890007004,0.9520421754959725,0.28536688833829704]];
                    this.mat_c = [[-0.578152088813599,-0.7064513398202348,-0.4082482904638632],[-0.5773498976584592,0.0006549863354206322,0.816496580927726],[0.5765477065033204,-0.7077613124910795,0.4082482904638628]];
                    this.mat_d = [[-0.08742223152828488,0.6787934643832862,0.7291068413786495],[-0.8826206834956467,0.2865778280416097,-0.37263102063654197],[-0.46188535644712997,-0.6761010140396846,0.5740638782524274]];

                    this.plot_layout1 = {
                        scene:{
                            aspectmode: "manual",
                            aspectratio: {x: 1, y: 1, z: 1},
                            xaxis: {
                                range: [-10, 10]
                            },
                            yaxis: {
                                range: [-10, 10]
                            },
                            zaxis: {
                                range: [-10, 10]
                            }
                        },
                    };

                    this.plot_data1 = [{
                        x: [],
                        y: [],
                        z: [],
                        type: 'scatter3d',
                        mode: 'markers',
                        marker: {
                            size: 5,
                            opacity: 0.8
                        },
                        name: 'Original'
                    },{
                        x: [],
                        y: [],
                        z: [],
                        type: 'scatter3d',
                        mode: 'markers',
                        marker: {
                            size: 5,
                            opacity: 0.8
                        },
                        name: 'Rotated'
                    }];

                }

                init(){
                    this.matrix_a_button = document.getElementById('matrixAButton');
                    this.matrix_b_button = document.getElementById('matrixBButton');
                    this.matrix_c_button = document.getElementById('matrixCButton');
                    this.matrix_d_button = document.getElementById('matrixDButton');
                    this.cov_mat_text = document.getElementById('covMatText');

                    let self = this;
                    this.matrix_a_button.addEventListener('click', function() { self.set_matrix_a(); });
                    this.matrix_b_button.addEventListener('click', function() { self.set_matrix_b(); });
                    this.matrix_c_button.addEventListener('click', function() { self.set_matrix_c(); });
                    this.matrix_d_button.addEventListener('click', function() { self.set_matrix_d(); });

                    this.data = data;

                    function unpack(rows, key) {
                    	return rows.map(function(row)
	                    { return row[key]; });
                    }

                    this.plot_data1[0].x = unpack(this.data, 0);
                    this.plot_data1[0].y = unpack(this.data, 1);
                    this.plot_data1[0].z = unpack(this.data, 2);

                    this.set_matrix_a();
                }
            
                set_matrix_a(){
                    this.rot_mat = this.mat_a;
                    this.update();
                }

                set_matrix_b(){
                    this.rot_mat = this.mat_b;
                    this.update();
                }

                set_matrix_c(){
                    this.rot_mat = this.mat_c;
                    this.update();
                }

                set_matrix_d(){
                    this.rot_mat = this.mat_d;
                    this.update();
                }

                update(){
                    var data_rot1 = []
                    var data_rot2 = []
                    var data_rot3 = []
                    for (var i = 0; i < this.data.length; i ++) {
                        data_rot1.push(this.rot_mat[0][0] * this.data[i][0] + 
                                       this.rot_mat[1][0] * this.data[i][1] + 
                                       this.rot_mat[2][0] * this.data[i][2]);
                        data_rot2.push(this.rot_mat[0][1] * this.data[i][0] + 
                                       this.rot_mat[1][1] * this.data[i][1] + 
                                       this.rot_mat[2][1] * this.data[i][2]);
                        data_rot3.push(this.rot_mat[0][2] * this.data[i][0] + 
                                       this.rot_mat[1][2] * this.data[i][1] + 
                                       this.rot_mat[2][2] * this.data[i][2]);
                    }

                    var cov11 = 0;
                    var cov12 = 0;
                    var cov13 = 0;
                    var cov22 = 0;
                    var cov23 = 0;
                    var cov33 = 0;
                    for (let i = 0; i < this.data.length; i += 1){
                        cov11 += data_rot1[i] * data_rot1[i] / this.data.length;
                        cov12 += data_rot1[i] * data_rot2[i] / this.data.length;
                        cov13 += data_rot1[i] * data_rot3[i] / this.data.length;
                        cov22 += data_rot2[i] * data_rot2[i] / this.data.length;
                        cov23 += data_rot2[i] * data_rot3[i] / this.data.length;
                        cov33 += data_rot3[i] * data_rot3[i] / this.data.length;
                    }

                    this.plot_data1[1].x = data_rot1;
                    this.plot_data1[1].y = data_rot2;
                    this.plot_data1[1].z = data_rot3;

                    Plotly.react('fig1', this.plot_data1, this.plot_layout1, {responsive: true});

                    this.cov_mat_text.innerHTML = `$$\\begin{bmatrix}${cov11.toFixed(2)}  & ${cov12.toFixed(2)}  & ${cov13.toFixed(2)} \\\\ ${cov12.toFixed(2)}  & ${cov22.toFixed(2)} & ${cov23.toFixed(2)} \\\\ ${cov13.toFixed(2)} & ${cov23.toFixed(2)}  & ${cov33.toFixed(2)}  \\end{bmatrix}$$`;
                    MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
                }
            }


            let data = [[5.128733525404221,6.492628663004663,-7.856523800605102],[10.921048765017309,9.65889354992159,-8.396738334825873],[-0.1739955392057091,2.6708403308206696,-5.515676200847048],[1.2947480018603872,2.3961936276836746,-3.4976392535069616],[1.4359563041663737,0.9221389504344435,-0.4083215967025133],[6.1051811701736565,4.79495123437156,-3.484721298569462],[2.0087755162653007,2.6481382249194656,-3.2875009335736305],[2.2224237749879188,2.3326126803590777,-2.442801585730236],[2.167525091252009,3.8667624281754156,-5.565999765098823],[-2.7902475539050964,-1.6230841129524702,0.4559206719998441],[-2.491505249906715,-5.6981136611811545,8.904722072455593],[-1.2397876839067563,0.36681353535919137,-1.973414754625139],[-1.2779534504198438,2.446166848166529,-6.1702871467529015],[-0.6572183655004422,-0.4242759981731626,0.19133363084588292],[8.942993508318056,9.006413952776228,-9.0698343972344],[1.822544929802527,1.5993298358972696,-1.3761147419920123],[-9.698757368155933,-8.60574664756212,7.512735926968305],[-0.07042842223638501,-0.5746895406665178,1.0789506590966504],[7.270100756593086,7.298011588536396,-7.3259224204797055],[-1.9838646371172468,-2.0688887039498636,2.15391277078248],[-7.7771776788500855,-7.405712706738203,7.034247734626321],[4.390561199677133,0.7335156138203311,2.923529972036471],[-2.7716015699480527,-2.8431794500885195,2.9147573302289866],[0.6043707032277879,-1.4259150126540483,3.456200728535885],[-4.0787568159717775,-5.47991438331576,6.881071950659743],[-0.24332313095030322,-1.525692190003241,2.8080612490561787],[-5.744139011627395,-5.074311965073855,4.404484918520316],[1.6569630254443608,1.2004489265752885,-0.7439348277062159],[1.3429220357254614,1.106967360368848,-0.8710126850122344],[-2.71960885131048,-2.9911897790043054,3.262770706698131],[-2.7831335417140672,-3.096040827949477,3.408948114184887],[-8.531422973415616,-7.618286653128393,6.7051503328411695],[-1.2522714603255418,-0.6730643818635271,0.09385730340151244],[-1.4092676718289925,-3.5022482743208116,5.59522887681263],[-1.6068151455819286,-2.56605890576131,3.525302665940691],[1.9741127673847165,2.5742204188048428,-3.174328070224969],[-2.660501912328009,-0.2862754074310556,-2.0879510974658975],[-1.9345570814061548,-0.8474053492882927,-0.23974638282956962],[-4.056992957421425,-4.3489404418388915,4.640887926256358],[-0.39844369533576357,-0.7661615696928816,1.1338794440499997],[1.2730062662500354,-0.7929700614875084,2.8589463892250517],[-5.213649865647975,-3.2117437396402915,1.209837613632608],[10.560061091713532,10.152424109478549,-9.744787127243566],[1.6378597990698978,2.9965642060418993,-4.355268613013901],[2.0763016647034616,-0.04890268373821782,2.1741070321798968],[4.0834263875833505,2.4578043702277435,-0.8321823528721364],[4.3231061020885715,3.554742043681719,-2.786377985274867],[3.5390254671165966,3.1888186960990503,-2.838611925081504],[7.164482017064982,5.389111543879967,-3.613741070694952],[1.8617816391860464,1.5867043684449647,-1.3116270977038829],[-1.6247348504572767,1.6061749077414242,-4.837084665940125],[1.3366168356605774,-0.9032648709831671,3.1431465776269123],[5.428237932368851,2.311493341605398,0.8052512491580543],[-3.8170572072825255,-3.4832213766015157,3.149385545920505],[9.767943218698466,10.210370453744426,-10.652797688790388],[7.359296553954681,8.320810856105865,-9.28232515825705],[5.91780844228673,3.1465178041329933,-0.3752271659792572],[2.67381884128282,1.6033590745350443,-0.5328993077872688],[1.2744635631841592,2.3767256240487415,-3.4789876849133234],[4.916985426958268,4.608858125737822,-4.300730824517375],[-3.644752100025519,-2.168925778285695,0.6930994565458712],[5.902019935160233,4.873872212679259,-3.8457244901982843],[-1.987673880773414,-2.5326072001771087,3.077540519580803],[6.526747810474093,4.242330530273113,-1.957913250072134],[2.9744368589893124,3.2392697797606376,-3.5041027005319627],[0.6171646162766362,-0.6920006494604974,2.001165915197631],[-1.2213430882173475,-1.9275063071490746,2.633669526080802],[1.434041023028237,0.12176164970285641,1.1905177236225244],[0.31998661091790237,1.1048761831108382,-1.8897657553037739],[-3.5802326095987325,-2.0911643882065816,0.6020961668144305],[-1.2249483803530634,-3.155597674323206,5.086246968293349],[2.8734727383134837,2.405114796793906,-1.936756855274329],[8.54420749768954,9.982872785563067,-11.421538073436595],[2.6424207014950944,0.6125821879550832,1.4172563255849284],[-4.478153240281879,-5.332476045978691,6.186798851675503],[6.716887675948204,4.935303348974206,-3.1537190220002085],[-4.795263798732938,-4.713580082122363,4.631896365511788],[-2.8508181942992943,-2.285792432362619,1.720766670425944],[-2.0664541892406794,0.14011324122925095,-2.3466806716991813],[-4.046217483799941,-4.7558660914666095,5.465514699133278],[6.722063313883333,4.294498809374042,-1.866934304864752],[2.249046579392285,3.110916144932855,-3.972785710473425],[0.9265808679458525,-1.1432176272858623,3.213016122517578],[-8.179515081889576,-7.634959332501529,7.090403583113482],[3.643830032404002,4.514917212831454,-5.386004393258906],[3.116628259333723,3.71875943017152,-4.320890601009318],[-0.8904411493952051,0.6174150558076329,-2.1252712610104707],[0.6578923895575786,-1.057944970508513,2.7737823305746048],[-4.365018439348484,-4.478878325772125,4.592738212195766],[-0.8411483709344594,-1.3141600334768593,1.7871716960192592],[-6.207792996179043,-5.186835614014508,4.165878231849973],[-10.180849414563488,-8.60106466517195,7.021279915780415],[-5.1577677203726155,-2.9304786137386802,0.7031895071047454],[-2.0001063618130037,-3.1566547805024285,4.313203199191854],[4.692932388844317,2.4103547970462675,-0.12777720524821845],[-1.5175103420501654,-3.077418121122797,4.637325900195428],[-4.750939627419781,-3.622128947906079,2.493318268392377],[0.360367996174515,1.0551909879285166,-1.7500139796825187],[4.837597718282261,4.7858841155321965,-4.734170512782132],[9.672583696306948,10.499291696151246,-11.325999695995543]];

            var app = new App();
            document.addEventListener("DOMContentLoaded", function(){
                app.init()
            });

        </script>
    </body>
</html>
